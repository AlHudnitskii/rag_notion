# 14. Modules, packages

Категория: Python Core
Статус: В процессе

Модуль - это файл с расширением `.py`, содержащий код на Python. Модули позволяют организовывать код, разделить его на логические части и повторно использовать функции, классы и переменные в разных проектах.

Пакет - это директория, содержащая модули. 
**Механизм поиска модулей** 

Когда вы выполняете команду `import abc`, Python выполняет следующие шаги:

1. Проверка кэша модулей  (`sys.modules`) - кэш всей ранее импортированных модулей. Если модуль уже был импортирован, Python использует его из кэша, не выполняя код модуля повторно.
2. Поиск во встроенных модулях. Если модуль не найден в кэше, Python  проверяет список встроенных модулей. 
3. Поиск в `sys.path`. Если модуль не является встроенным, Python ищет его в директориях, перечисленных в `sys.path`. Это список путей, в котором Python ищет модули. 

![image.png](image%20201.png)

1. Если модуль найден, Python привязывает его к имени локальной области видимости. В противном случае, возникает исключение `ModuleNotFoundError`.

`sys.path` формируется из следующих источников (в порядке приоритета):

1. **Текущая рабочая директория** — директория, из которой запущен скрипт Python.
2. **Переменная окружения `PYTHONPATH`** — если она установлена.
3. **Пути по умолчанию** — зависят от установки Python и управляются модулем `site`. 

Модуль `site` автоматически импортируется при запуске Python и отвечает за настройку `sys.path`. Он добавляет директории для пакетов, установленных через pip:

- `site-packages` — для пользовательских пакетов
- `dist-packages` — для системных пакетов.

Абсолютный путь импорта указывает полный путь к импортируемому ресурсу от корня проекта.

![image.png](image%20202.png)

Относительный импорт указывает путь к ресурсу относительно текущего местоположения файла.

Точечная нотация:

- `.` — текущая директория (тот же уровень).
- `..` — родительская директория (уровень выше).
- `...` — директория на два уровня выше.

**Изменение пути поиска модулей**

1. Модификация `sys.path` во время выполнения:

![image.png](image%20203.png)

1. Использование переменной окружения `PYTHONPATH` — это переменная окружения, которая позволяет добавлять пути поиска модулей без изменения кода.

![image.png](image%20204.png)

**Дополнительные атрибуты модулей**

1. Атрибут `__name__` содержит имя модуля. Для главного скрипта равен `'__main__'`.

![image.png](image%20205.png)

1. Атрибут `__file__` содержит путь к файлу модуля в файловой системе. Важно отметить, что этот атрибут отсутствует у встроенных модулей, скомпилированных в интерпретатор.

![image.png](image%20206.png)

1. Атрибут `__doc__`  содержит строку документации модуля (docstring).
2. Атрибут `__package__` содержит имя пакета, к которому принадлежит модуль.
3. Атрибут `__path__` присутствует только у пакетов (не у обычных модулей). Содержит список директорий, где Python ищет подмодули пакета.

Правила оформления:

1. **Импорты в начале файла** — после комментариев модуля и docstring.
2. **Группировка импортов**:
    - Стандартная библиотека.
    - Сторонние пакеты.
    - Локальные модули приложения.
3. **Разделение групп** пустой строкой.
4. **Алфавитный порядок** внутри каждой группы.

![image.png](image%20207.png)

Немного про __**init**__.py
Файл `__init__.py`  — это особый файл в Python, который играет **фундаментальную роль** в структуре пакетов. Необходим для того, чтобы Python распознавал директорию с данным файлов как обычный пакет.
Код внутри `__init__.py` **выполняется автоматически** в первый раз, когда импортируется его содержащий пакет.

Обычно в данный файл помещают: 

1. Определение метаданных проекта. Можно получить доступ к версии как `my_package.__version__`.

![image.png](image%20208.png)

1. Настройку логирования/конфигурации.

По умолчанию Python импортирует все имена, которые не начинаются с подчеркивания. Однако это можно явно контролировать, определив список `__all__` в `__init__.py`.

![image.png](image%20209.png)