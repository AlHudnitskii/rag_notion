ё# 1. DML

Категория: SQL Databases
Статус: Готово

Data Manipulation Language (DML)  - набор SQL-команд, которые используются для управления и манипуляции данными внутри таблиц БД. DML команды включают `SELECT`,`INSERT`, `UPDATE`, `DELETE` and `MERGE.` 

### SELECT (Выборка данных)

![image.png](image%20521.png)

Для получения информации обо всех столбцах нужно использовать *, DISTINCT не отображает повторения.

Конкатенация строк: 

![image.png](image%20522.png)

Для оптимизации `DISTINCT` в PostgreSQL на уровне СУБД рекомендуется использовать индексы для столбцов, по которым проводится поиск уникальных значений, так как это позволяет избежать полного сканирования таблицы.

### INSERT (Добавление данных)

Чтобы создать строку, вы будете использовать команду [INSERT](https://postgrespro.ru/docs/postgresql/current/sql-insert.html). В этой команде необходимо указать имя таблицы и значения столбцов.

![image.png](image%20523.png)

Показанная выше запись имеет один недостаток — вам необходимо знать порядок столбцов в таблице. Чтобы избежать этого, можно перечислить столбцы явно. Например, следующие две команды дадут тот же результат, что и показанная выше:

![image.png](image%20524.png)

Если значения определяются не для всех столбцов, лишние столбцы можно опустить. В таком случае эти столбцы получат значения по умолчанию. Например:

![image.png](image%20525.png)

Также возможно вставить результат запроса (который может не содержать строк либо содержать одну или несколько):

![image.png](image%20526.png)

P.S. Когда нужно добавить сразу множество строк, возможно будет лучше использовать команду [COPY](https://postgrespro.ru/docs/postgresql/current/sql-copy.html). Она не такая гибкая, как [INSERT](https://postgrespro.ru/docs/postgresql/current/sql-insert.html), но гораздо эффективнее.

### UPDATE (Изменение данных)

Изменить можно все строки таблицы, либо подмножество всех строк, либо только избранные строки. Каждый столбец при этом можно изменять независимо от других.

![image.png](image%20527.png)

![image.png](image%20528.png)

### DELETE (Удаление данных)

Для удаления строк используется команда [DELETE](https://postgrespro.ru/docs/postgresql/current/sql-delete.html); её синтаксис очень похож на синтаксис команды [UPDATE](https://postgrespro.ru/docs/postgresql/current/sql-update.html). Например, удалить все строки из таблицы с товарами, имеющими цену 10, можно так:

![image.png](image%20529.png)

Если условие прописано не будет, то будут удалены все строки таблицы:

![image.png](image%20530.png)

MERGE (Соединение)

![image.png](image%20531.png)

MERGE по факту не является чем-то без чего нельзя прожить, ибо его действия можно эмулировать используя UPDATE и INSERT: 

![image.png](image%20532.png)

Пример команды MERGE:

![image.png](image%20533.png)
