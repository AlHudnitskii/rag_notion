# 12. Git

Категория: Infr as code & CI/CD & General Theory
Статус: В процессе

### Git commands

Опытные разработчики используют не только базовые команды вроде `commit`, `push`, `pull`, но и более продвинутые инструменты для управления историей и рабочим процессом, такие как `rebase` для чистой истории веток, `stash` для временного сохранения изменений, `cherry-pick` для переноса отдельных коммитов, `bisect` для поиска проблемных коммитов, и `reflog` для восстановления потерянных коммитов. Они также активно используют алиасы и гибкие настройки `git config`, чтобы ускорить рутинные операции, а `git checkout`/`switch`, `git restore` и `git reset` применяют для точного управления состоянием репозитория и отмены изменений.

**Основные команды для ежедневной работы**

- **`git status`**: Всегда актуальное состояние репозитория.
- **`git add .` / `git add <file>`**: Добавление изменений в staging область.
- **`git commit -m "Сообщение"`**: Сохранение коммита.
- **`git push origin <branch>`**: Отправка локальных коммитов на удаленный сервер.
- **`git pull origin <branch>`**: Загрузка и слияние изменений с удаленного репозитория.
- **`git branch`**: Управление ветками.
- **`git checkout <branch>` / `git switch <branch>`**: Переключение между ветками (новые версии).

`*git checkout` — это универсальная, «старая» команда для переключения веток и восстановления файлов, а `git switch` (появившаяся в Git 2.23) — новая, специализированная команда для только переключения веток, более безопасная, так как она явно отделяет логику работы с ветками от работы с файлами, предотвращая ошибки и путаницу с многофункциональным `checkout`.* 

**Команды для управления историей и отладкой**

- **`git log`**: Просмотр истории коммитов, опции: `git log --oneline`, `git log --graph`.
- **`git diff`**: Показать различия (локальные или между ветками).
- **`git reset HEAD <file>` / `git restore --staged <file>`**: Отменить `add`, но оставить изменения в рабочей директории.
- **`git reset --hard <commit>` / `git restore .`**: Полностью отменить изменения до указанного коммита.
- **`git revert <commit>`**: Создать новый коммит, отменяющий предыдущий.
- **`git stash`**: Временно сохранить "грязные" изменения, чтобы переключиться на другую задачу, `git stash pop` - вернуть их.
- **`git rebase -i HEAD~N`**: Интерактивный перебазирование для очистки истории (переписать, объединить коммиты).
- [**git blame](https://www.google.com/search?q=git+blame&client=opera&hs=oxy&sca_esv=cf3d8fcadb69d60c&sxsrf=AE3TifOfv2UMvci7vYaxderwqrucx2j6Yg%3A1765908155655&ei=u55BadLhJ_fAwPAPvuve-Qg&ved=2ahUKEwihyuDE2MKRAxVpTVUIHZi4LPwQgK4QegQIBRAI&uact=5&oq=%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5+%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D1%8B+Git+%D0%BE%D1%82+%D0%BE%D0%BF%D1%8B%D1%82%D0%BD%D0%BE%D0%B3%D0%BE+%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%B0&gs_lp=Egxnd3Mtd2l6LXNlcnAiUtCe0YHQvdC-0LLQvdGL0LUg0LrQvtC80LDQvdC00YsgR2l0INC-0YIg0L7Qv9GL0YLQvdC-0LPQviDRgNCw0LfRgNCw0LHQvtGC0YfQuNC60LAyCBAAGIAEGKIEMgUQABjvBTIIEAAYgAQYogQyCBAAGKIEGIkFSNgTUOcCWNURcAJ4AZABAJgBfKABsAKqAQMxLjK4AQPIAQD4AQGYAgWgAsYCwgIKEAAYsAMY1gQYR8ICBhAhGAoYKpgDAIgGAZAGCJIHAzMuMqAH0Q2yBwMxLjK4B7wCwgcFMC4zLjLIBw2ACAA&sclient=gws-wiz-serp&mstk=AUtExfDBIFfHyW32vh7vAVQMSXaFRvDTGyQavSJmHFk4tDhfiG1SUNGhYBB-E76VVdRR65eHBesa03Y96oIom3UekFOsorXA5NIeNgIfOkQvmgmZmd1HGOx7pJXvr1mkhTS56o5vVdPxMOXEROvuR8yv-XykwoMSlY61orOe_rPix0fEr9VfE6wzsaAoow3gsAnSVL4lNclwHn4Te3QY4F1pirAmmt9_rQNbV66tjjpjVnjrB6tpl03LPqt2JsfhS3OXTAVuAyCY5TpukyrlxkqaS7_RFhDQw03ytiQnge830Xzneg&csui=3)** : Показать, кто и когда изменил каждую строку в файле.
- [**git clean](https://www.google.com/search?q=git+clean&client=opera&hs=oxy&sca_esv=cf3d8fcadb69d60c&sxsrf=AE3TifOfv2UMvci7vYaxderwqrucx2j6Yg%3A1765908155655&ei=u55BadLhJ_fAwPAPvuve-Qg&ved=2ahUKEwihyuDE2MKRAxVpTVUIHZi4LPwQgK4QegQIBRAK&uact=5&oq=%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5+%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D1%8B+Git+%D0%BE%D1%82+%D0%BE%D0%BF%D1%8B%D1%82%D0%BD%D0%BE%D0%B3%D0%BE+%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%B0&gs_lp=Egxnd3Mtd2l6LXNlcnAiUtCe0YHQvdC-0LLQvdGL0LUg0LrQvtC80LDQvdC00YsgR2l0INC-0YIg0L7Qv9GL0YLQvdC-0LPQviDRgNCw0LfRgNCw0LHQvtGC0YfQuNC60LAyCBAAGIAEGKIEMgUQABjvBTIIEAAYgAQYogQyCBAAGKIEGIkFSNgTUOcCWNURcAJ4AZABAJgBfKABsAKqAQMxLjK4AQPIAQD4AQGYAgWgAsYCwgIKEAAYsAMY1gQYR8ICBhAhGAoYKpgDAIgGAZAGCJIHAzMuMqAH0Q2yBwMxLjK4B7wCwgcFMC4zLjLIBw2ACAA&sclient=gws-wiz-serp&mstk=AUtExfDBIFfHyW32vh7vAVQMSXaFRvDTGyQavSJmHFk4tDhfiG1SUNGhYBB-E76VVdRR65eHBesa03Y96oIom3UekFOsorXA5NIeNgIfOkQvmgmZmd1HGOx7pJXvr1mkhTS56o5vVdPxMOXEROvuR8yv-XykwoMSlY61orOe_rPix0fEr9VfE6wzsaAoow3gsAnSVL4lNclwHn4Te3QY4F1pirAmmt9_rQNbV66tjjpjVnjrB6tpl03LPqt2JsfhS3OXTAVuAyCY5TpukyrlxkqaS7_RFhDQw03ytiQnge830Xzneg&csui=3) -df`**: Удалить неотслеживаемые файлы и папки (осторожно!).

**Продвинутые и командно-ориентированные**

- **`git cherry-pick <commit>`**: Применить один конкретный коммит из другой ветки.
- [**git fetch**](https://www.google.com/search?q=git+fetch&client=opera&hs=oxy&sca_esv=cf3d8fcadb69d60c&sxsrf=AE3TifOfv2UMvci7vYaxderwqrucx2j6Yg%3A1765908155655&ei=u55BadLhJ_fAwPAPvuve-Qg&ved=2ahUKEwihyuDE2MKRAxVpTVUIHZi4LPwQgK4QegQICBAC&uact=5&oq=%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5+%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D1%8B+Git+%D0%BE%D1%82+%D0%BE%D0%BF%D1%8B%D1%82%D0%BD%D0%BE%D0%B3%D0%BE+%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%B0&gs_lp=Egxnd3Mtd2l6LXNlcnAiUtCe0YHQvdC-0LLQvdGL0LUg0LrQvtC80LDQvdC00YsgR2l0INC-0YIg0L7Qv9GL0YLQvdC-0LPQviDRgNCw0LfRgNCw0LHQvtGC0YfQuNC60LAyCBAAGIAEGKIEMgUQABjvBTIIEAAYgAQYogQyCBAAGKIEGIkFSNgTUOcCWNURcAJ4AZABAJgBfKABsAKqAQMxLjK4AQPIAQD4AQGYAgWgAsYCwgIKEAAYsAMY1gQYR8ICBhAhGAoYKpgDAIgGAZAGCJIHAzMuMqAH0Q2yBwMxLjK4B7wCwgcFMC4zLjLIBw2ACAA&sclient=gws-wiz-serp&mstk=AUtExfDBIFfHyW32vh7vAVQMSXaFRvDTGyQavSJmHFk4tDhfiG1SUNGhYBB-E76VVdRR65eHBesa03Y96oIom3UekFOsorXA5NIeNgIfOkQvmgmZmd1HGOx7pJXvr1mkhTS56o5vVdPxMOXEROvuR8yv-XykwoMSlY61orOe_rPix0fEr9VfE6wzsaAoow3gsAnSVL4lNclwHn4Te3QY4F1pirAmmt9_rQNbV66tjjpjVnjrB6tpl03LPqt2JsfhS3OXTAVuAyCY5TpukyrlxkqaS7_RFhDQw03ytiQnge830Xzneg&csui=3): Получить информацию о новых коммитах с удаленного репозитория, но не сливать их.
- [**git merge --abort**](https://www.google.com/search?q=git+merge+--abort&client=opera&hs=oxy&sca_esv=cf3d8fcadb69d60c&sxsrf=AE3TifOfv2UMvci7vYaxderwqrucx2j6Yg%3A1765908155655&ei=u55BadLhJ_fAwPAPvuve-Qg&ved=2ahUKEwihyuDE2MKRAxVpTVUIHZi4LPwQgK4QegQICBAE&uact=5&oq=%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5+%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D1%8B+Git+%D0%BE%D1%82+%D0%BE%D0%BF%D1%8B%D1%82%D0%BD%D0%BE%D0%B3%D0%BE+%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%B0&gs_lp=Egxnd3Mtd2l6LXNlcnAiUtCe0YHQvdC-0LLQvdGL0LUg0LrQvtC80LDQvdC00YsgR2l0INC-0YIg0L7Qv9GL0YLQvdC-0LPQviDRgNCw0LfRgNCw0LHQvtGC0YfQuNC60LAyCBAAGIAEGKIEMgUQABjvBTIIEAAYgAQYogQyCBAAGKIEGIkFSNgTUOcCWNURcAJ4AZABAJgBfKABsAKqAQMxLjK4AQPIAQD4AQGYAgWgAsYCwgIKEAAYsAMY1gQYR8ICBhAhGAoYKpgDAIgGAZAGCJIHAzMuMqAH0Q2yBwMxLjK4B7wCwgcFMC4zLjLIBw2ACAA&sclient=gws-wiz-serp&mstk=AUtExfDBIFfHyW32vh7vAVQMSXaFRvDTGyQavSJmHFk4tDhfiG1SUNGhYBB-E76VVdRR65eHBesa03Y96oIom3UekFOsorXA5NIeNgIfOkQvmgmZmd1HGOx7pJXvr1mkhTS56o5vVdPxMOXEROvuR8yv-XykwoMSlY61orOe_rPix0fEr9VfE6wzsaAoow3gsAnSVL4lNclwHn4Te3QY4F1pirAmmt9_rQNbV66tjjpjVnjrB6tpl03LPqt2JsfhS3OXTAVuAyCY5TpukyrlxkqaS7_RFhDQw03ytiQnge830Xzneg&csui=3): Отменить незавершенное слияние.
- **`git remote -v`**: Показать удаленные репозитории.
- **`git config`**: Настройка пользователя, алиасов и т.д..

Опытный разработчик знает, *когда* использовать `rebase` (в своих ветках) и `merge` (для слияния в общие ветки), умеет «чинить» историю и не боится использовать `reflog`, когда что-то потерялось.

### Merge Conflict

Конфликт слияния (Merge Conflict) в системах контроля версий, таких как Git, — это ситуация, когда автоматическое объединение изменений из разных веток невозможно, потому что одни и те же строки файла были изменены по-разному в обеих ветках, или один разработчик удалил файл, а другой его редактировал. Git не может сам принять решение о том, какие изменения оставить, и просит разработчика вручную разрешить противоречия. 

Чтобы решить конфликт слияния (merge conflict) в Git, нужно вручную отредактировать конфликтующие файлы, используя маркеры `<<<<<<<`, `=======`, `>>>>>>>` для выбора нужного кода (или создания нового), затем добавить измененные файлы командой `git add <имя_файла>` и завершить слияние с помощью `git commit` или `git merge --continue`, либо отменить его через `git merge --abort`.

**Пошаговая инструкция:**

1. **Определите конфликты:**
    - Выполните `git status`, чтобы увидеть список файлов, в которых возникли конфликты (они будут отмечены как `unmerged`).
2. **Откройте конфликтующие файлы:**
    - Откройте файл в текстовом редакторе (VS Code, IntelliJ, Sublime Text и т.д.).
    - Найдите блоки с маркерами:
        
        `<<<<<<< HEAD (или текущая ветка)
        // Ваш код
        =======
        // Код из другой ветки
        >>>>>>> [имя_другой_ветки]`
        
3. **Разрешите конфликт:**
    - **Удалите маркеры** (`<<<<<<<`, `=======`, `>>>>>>>`).
    - **Выберите:**
        - Оставить только ваш код (из `HEAD`).
        - Оставить только код из другой ветки.
        - Объединить код, написав новый, правильный вариант вручную.
    - Сохраните файл.
4. **Подготовьте изменения:**
    - После исправления каждого файла добавьте его в staging area: `git add <имя_файла>`.
5. **Завершите слияние:**
    - Выполните `git commit`, чтобы создать коммит слияния. Если вы делали слияние через `git pull`, команда будет `git commit --continue` или просто `git commit`, в зависимости от настроек.
    - В графических клиентах (GitHub Desktop, VS Code) есть кнопки "Commit merge".

**Дополнительные команды:**

- `git log --merge`: Показывает историю конфликтующих коммитов.
- `git merge --abort`: Отменяет текущую операцию слияния, возвращая в исходное состояние.

**Инструменты:**

- **VS Code:** Предлагает кнопки "Accept Current", "Accept Incoming", "Accept Both" прямо в редакторе.
- **GitHub/GitLab:** Позволяют разрешать конфликты онлайн через интерфейс Pull/Merge Request.