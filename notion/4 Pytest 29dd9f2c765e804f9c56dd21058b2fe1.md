# 4. Pytest

Категория: Testing
Статус: В процессе

Pytest — самый популярный фреймворк для тестирования в Python. Он более современный и удобный, чем unittest.

- **Простой синтаксис:** просто пишешь функции с `test_` в начале
- **Assertions:** используешь обычный `assert`, pytest сам делает красивый вывод ошибок
- **Fixtures:** мощная система для подготовки данных и ресурсов
- **Параметризация:** легко запускать один тест с разными данными
- **Плагины:** огромная экосистема (pytest-django, pytest-asyncio, pytest-cov)

![image.png](image%20261.png)

![image.png](image%20262.png)

![image.png](image%20263.png)

Маркеры позволяют помечать тесты для группировки и условного выполнения.

1. @pytest.mark.skip(reason="Not implemented yet")
2. @pytest.mark.skipif(sys.version_info < (3, 8), reason="Requires Python 3.8+")
3. @pytest.mark.xfail(reason="Known bug #123")
4. @pytest.mark.slow

**Регистрация кастомных маркеров в pytest.ini:**

![image.png](image%20264.png)

![image.png](image%20265.png)

Фикстуры — это сердце pytest. Они позволяют переиспользовать код подготовки данных.

![image.png](image%20266.png)

**Параметризованные фикстуры**

![image.png](image%20267.png)

**conftest.py — файл для общих фикстур**

![image.png](image%20268.png)

pytest.ini — конфигурация

![image.png](image%20269.png)

Плагин для pytest - “pytest-django”

![image.png](image%20270.png)

**Pytest-xdist** - плагин для параллельного запуска pytest тестов на нескольких CPU/ядрах.

![image.png](image%20271.png)

### **Преимущества:**

- **Ускорение** тестов в 2-8 раз
- **Эффективное использование** многозадачных процессоров
- **Простота использования** - одна команда

### **Ограничения:**

- **Проблемы** с тестами, использующими общие ресурсы
- **Нужна изоляция** БД, файлов, сетевых портов

### **Monkeypatching в pytest**

**Monkeypatching** - временная замена объектов, функций или атрибутов во время тестов.

1. Замена функции 

![image.png](image%20272.png)

1. Замена атрибутов 

![image.png](image%20273.png)

### **Ключевые особенности:**

- **Автоматическое восстановление** после теста
- **Работает с любыми объектами** (функции, классы, модули)
- **Фикстура pytest** - просто добавьте `monkeypatch` в параметры