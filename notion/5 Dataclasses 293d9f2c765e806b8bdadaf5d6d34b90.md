# 5. Dataclasses

Категория: Python Core
Статус: В процессе

Data Classes (появились в Python 3.7)  призваны автоматизировать генерацию кода классов, которые используют для хранения данных. 

Допустим, мы хотим создать такой класс, как: 

![image.png](image%2024.png)

Уже здесь можно заметить избыточность. Идентификаторы title и author используются несколько раз. Реальный же класс будет еще содержать и переопределенные методы `__eq__` и `__repr__`. Используя декоратор @dataclass из модуля dataclasses, этот код будет выглядеть вот так:

![image.png](image%2025.png)

Важно отметить, что аннотация типов в таком случае обязательна. Все поля, которые не имеют отметок о типе будут проигнорированы. 

В результате использования разработчик получает класс с УЖЕ реализованными методами `__init__`, `__repr__`, `__str__` и `__eq__`. Кроме того, это будет обычным класс и вы можете наследоваться от него или добавлять произвольные методы.
Для создания класса данных можно воспользоваться декоратором @dataclass. В этом случае, все поля класса, определенные с аннотацией типов будут использоваться в соответствующих методах результирующего класса. В качестве альтернативы есть функция make_dataclass, которая работает аналогично созданию именованных кортежей. 

![image.png](image%2026.png)

Одна из особенностей - легкость добавления к полям значений по умолчанию.

![image.png](image%2027.png)

Настройка класса данных:

1. frozen - Используется для неизменяемости экземпляра класса.  При указании  frozen=True при создании класса и последующей попытке изменять это поля,  выбросится исключение FrozenInstanceError

![image.png](image%2028.png)

![image.png](image%2029.png)

1. init - Если он равен True (по умолчанию), генерируется метод `__init__.` 
2. repr - Если он равен True (по умолчанию), генерируется метод `__repr__.` 
3. eq - Если он равен True (по умолчанию), генерируется метод `__eq__.` 
4. order - False (по умолчанию) включает создание методов `__lt__`, `__le__`, `__gt__` и `__ge__`. Если order задан, а eq - нет, то будет сгенерировано исключение ValueError. 
5. unsafe_hash - влияет на генерацию метода `__hash__`. Поведение так же зависит от значений параметров eq и frozen.

Для изменяемых значений по умолчанию используется параметр default_factor функции field.

![image.png](image%2030.png)

Другие параметры функции field:

1. `default`: значение по умолчанию. Этот параметр необходим, так как вызов `field` заменяет задание значения поля по умолчанию.
2. `init`: включает (задан по умолчанию) использование поля в методе `__init__`
3. `repr`: включает (задан по умолчанию) использование поля в методе `__repr__`
4. `compare` включает (задан по умолчанию) использование поля в методах сравнения (`__eq__`, `__le__` и других).
5. `hash`: может быть булевое значение или `None`. Если он равен `True`, поле используется при вычислении хэша. Если указано `None` (по умолчанию) — используется значение параметра `compare`. 
6. `metadata`: произвольный словарь или `None`. Значение оборачивается в `MappingProxyType`, чтобы оно стало неизменяемым. Этот параметр не используется самими классами данных и предназначено для работы сторонних расширений.

Для обработки после инициализации используется метод __**post_init__.**

Если метод `__init__` не был сгенерирован, то он `__post_init__` не будет вызываться.

![image.png](image%2031.png)