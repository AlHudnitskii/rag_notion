# 12. Iterators & Generators

Категория: Python Core
Статус: Готово

**Итерация** - это процесс последовательного перебора элементов коллекции. В Python итерация лежит в основе многих конструкций: циклов`for`, генераторов списков, функций `map()`, `filter()` и многих других.
**Итерируемый объект** - это любой объект, который может возвращать свои элементы по одному. К итерируемым объектам относятся:

1. Последовательности: списки, кортежи, строки, range.
2. Неупорядоченные коллекции: множества, словари.
3. Файловые объекты.
4. Любые объекты, реализующие методы `__iter__()` или `__getitem__()`.

Цикл `for` в Python отличается от циклов в других языках. Он не использует индексы, а работает через протокол итератора. Попытка эмулировать `for` через `while` с индексами работает только для последовательностей.

В случае, если нужны именно индексы, можно воспользоваться `enumerate()`:

![image.png](image%20138.png)

![image.png](image%20139.png)

**Итератор** - это объект, который реализует протокол итератора, состоящий из двух методов:

1. `__iter__()` — возвращает сам итератор.
2. `__next__()` — возвращает следующий элемент или вызывает `StopIteration`, когда элементы закончились.

Итератор можно получить из любого итерируемого объекта с помощью встроенной функции `iter()`:

![image.png](image%20140.png)

![image.png](image%20141.png)

Для получения следующего элемента используется функция `next().`

![image.png](image%20142.png)

Особенности итераторов:

1. Одноразовость: После того, как итератор исчерпан, он становится бесполезным.

![image.png](image%20143.png)

1. Отсутствие индексации: Итераторы не поддерживает доступ по индексу.   

![image.png](image%20144.png)

1. Итераторы хранят списки из большого числа элементов у себя в памяти

![image.png](image%20145.png)

1. Передача итератора в `iter` возвращает тот же объект:

![image.png](image%20146.png)

Встроенные итераторы в Python: 

1. enumerate.
2. zip.
3. open.

Для создания собственного итератора нужно реализовать методы `__iter__()` и `__next__()`:

![image.png](image%20147.png)

Генератор - это специальный вид итератора, который создается с помощью функции с ключевым словом `yield` или генераторного выражения. Генераторы автоматически реализуют протокол итератора.

![image.png](image%20148.png)

Ключевое слово `yield` отличается от `return`:

- `return` завершает выполнение функции
- `yield` "замораживает" функцию, сохраняя её состояние, и возобновляет выполнение при следующем вызове `next()`

В случае, если в генераторе встречается `return` , то генератор завершается с исключением `StopIteration` .

`yield from` используется в генераторах для делегирования, то есть для передачи выполнения другому генератору. 

Для создания генератора на основе класса необходимо в классе определить методы `__iter__()` , в котором использует `yield` .

![image.png](image%20149.png)

![image.png](image%20150.png)

**Генераторное выражение** - это компактный способ создания генератора без определения функции. Синтаксис похож на генератор списка, но использует круглые скобки:

![image.png](image%20151.png)

Можно использовать условный оператор для разной обработки элементов:

![image.png](image%20152.png)

Класс становится генератором через реализацию `__iter__` и `__next__`:

![image.png](image%20153.png)

Генераторы коллекций:

1. Генератор списка (list comprehension): 

![image.png](image%20154.png)

1. Генератор множества (set comprehension)

![image.png](image%20155.png)

1. Генератор словаря (dictionary comprehension)

![image.png](image%20156.png)

1. Генератор строк через join()

![image.png](image%20157.png)

Особенности генераторных выражений:

1. Одноразовость 

![image.png](image%20158.png)

1. Проверка вхождения “съедает” элементы:

![image.png](image%20159.png)

1. Нельзя получить длину:

![image.png](image%20160.png)

1. Бесконечные генераторы (в помощью модуля `itertools`):

![image.png](image%20161.png)

1. Скобки необязательны при передаче в функцию:

![image.png](image%20162.png)

Польза генераторов:

1. Экономия памяти: главное преимущество генераторов - они не хранят все элементы в памяти одновременно:

![image.png](image%20163.png)

1. Ленивые вычисления: генераторы вычисляются значения только когда они нужны: 

![image.png](image%20164.png)

1. Бесконечные последовательности: генераторы позволяют работать с бесконечными последовательностями:

![image.png](image%20165.png)

1. Генераторы выполняются быстрее, когда нужны не все элементы:

![image.png](image%20166.png)

Примеры генераторов:

1. Дерево файлов  

![image.png](image%20167.png)