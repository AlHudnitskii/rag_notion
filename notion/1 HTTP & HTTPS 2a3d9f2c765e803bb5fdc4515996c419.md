# 1. HTTP & HTTPS

Категория: Web & Networks
Статус: Готово

## SSL/TLS

SSL и TLS — это **криптографические протоколы, обеспечивающие безопасность передачи данных по сети за счет шифрования, аутентификации и защиты от перехвата и подмены**. TLS (Transport Layer Security) — это современный, более безопасный преемник устаревшего SSL (Secure Sockets Layer), но термин "SSL" по-прежнему часто используется для обозначения этих технологий, например, для HTTPS-соединений. 

*Протокол* — это набор правил, определяющих формат и порядок обмена информацией между устройствами, программами или людьми. 

### SSL

SSL (Secure Sockets Layer)- интернет протокол безопасности, основанный на безопасности. SSL является предшественником современного шифрования TLS.

Сайт, использующий SSL/TLS имеет ‘https’ вместо ‘http’.

![http-vs-https.svg](http-vs-https.svg)

- Для обеспечения высокой степени конфиденциальности SSL шифрует данные, передаваемые через Интернет. Это означает, что любой, кто попытается перехватить эти данные, увидит лишь искажённую смесь символов, которую практически невозможно расшифровать.
- SSL инициирует процесс аутентификации, называемый рукопожатием, между двумя взаимодействующими устройствами, чтобы убедиться, что оба устройства действительно являются теми, за кого себя выдают.
- SSL также добавляет цифровую подпись к данным для обеспечения целостности данных, проверяя, что данные не были подделаны до достижения адресатом.

В 1999 году SSL был обновлен до TLS.

SSL был создан для решения защиты конфиденциальности пользователей. Шифруя все данные, передаваемые между пользователем и веб-сервером, SSL гарантирует, что любой, кто перехватит эти данные, увидит лишь беспорядочный набор символов.

SSL также блокирует определённые виды кибератак: он аутентифицирует веб-серверы, что важно, поскольку злоумышленники часто пытаются создавать поддельные веб-сайты для обмана пользователей и кражи данных. 

Различия между финальной версией SSL (3.0) и первой версией TLS незначительны; изменение названия было применено для обозначения смены владельца.

SSL не обновлялся с момента выхода SSL 3.0 в 1996 году и в настоящее время считается устаревшим. В протоколе SSL есть несколько известных уязвимостей, и эксперты по безопасности рекомендуют прекратить его использование. Более того, большинство современных веб-браузеров вообще не поддерживают SSL.

SSL может быть реализован только веб-сайтами, имеющими SSL-сертификат (технически «TLS-сертификат»). Одним из важнейших элементов информации в SSL-сертификате является открытый ключ веб-сайта. Открытый ключ обеспечивает шифрование и аутентификацию. 

Устройство пользователя видит открытый ключ и использует его для установления безопасных ключей шифрования с веб-сервером. При этом веб-сервер также имеет закрытый ключ, который хранится в секрете; закрытый ключ расшифровывает данные, зашифрованные с помощью открытого ключа.

Существует несколько различных типов SSL-сертификатов:

- Однодоменный -  ****SSL-сертификат для одного домена применяется только к одному домену.
- Универсальный - SSL-сертификат для одного домена, как и сертификат для одного домена, применяется только к одному домену. Однако он также распространяется на его поддомены.
- Многодоменный - Как следует из названия, многодоменные SSL-сертификаты могут применяться к нескольким не связанным между собой доменам.

Уровни проверки в SSL:

- Проверка домена -  ****это наименее строгий и самый дешёвый уровень проверки.
- Проверка организации - центр сертификации напрямую связывается с лицом или компанией, запрашивающей сертификат.
- Расширенная проверка - перед выдачей SSL-сертификата требуется полная проверка биографических данных организации.

### TLS

TLS (Transport Layer Security) - криптографический протокол, обеспечивающий защищенную передачу данных между узлами в сети Интернет.

Данный протокол широко используется в приложениях, работающих с сетью Интернет, таких как веб-браузеры, работа с электронной почтой и обмен мгновенными сообщениями.

Так как большинство протоколов связи может быть использовано как с TLS (или SSL), так и без них, при установке соединения необходимо явно указать серверу, хочет ли клиент устанавливать TLS. Это может быть достигнуто либо с помощью использования унифицированного номера порта, по которому соединение всегда устанавливается с использованием TLS (как, например, порт 443 для HTTPS), либо с использованием произвольного порта и специальной команды серверу со стороны клиента на переключение соединения на TLS с использованием специальных механизмов протокола.

### Создание сеанса связи в TLS

Основные шаги процедуры создания защищённого сеанса связи:

- клиент подключается к серверу, поддерживающему TLS, и запрашивает защищённое соединение;
- клиент предоставляет список поддерживаемых алгоритмов шифрования и хеш-функций;
- сервер выбирает из списка, предоставленного клиентом, наиболее надёжные алгоритмы среди тех, которые поддерживаются сервером, и сообщает о своём выборе клиенту;
- сервер отправляет клиенту цифровой сертификат для собственной аутентификации. Обычно цифровой сертификат содержит имя сервера, имя удостоверяющего центра сертификации и открытый ключ сервера;
- клиент, до начала передачи данных, проверяет валидность (аутентичность) полученного серверного сертификата относительно имеющихся у клиента корневых сертификатов удостоверяющих центров (центров сертификации).
- для шифрования сессии используется сеансовый ключ. Существует исторический метод передачи сгенерированного клиентом секрета на сервер при помощи шифрования асимметричной криптосистемой RSA (используется ключ из сертификата сервера).

![image.png](image%20378.png)

### Меры безопасности TLS

TLS имеет множество мер безопасности:

- защита от понижения версии протокола к предыдущей (менее защищённой) версии или менее надёжному алгоритму шифрования.
- нумерация последовательных записей приложения и использование порядкового номера в коде аутентификации сообщения.
- использование ключа в идентификаторе сообщения (только владелец ключа может сгенерировать код аутентификации сообщения).
- сообщение, которым заканчивается подтверждение связи («Finished»), используется для подтверждения аутентичности ранее переданных сообщений и, таким образом, выбранных параметров TLS-соединения.

### Процесс установки связи в TLS

Далее показан простой пример установления соединения, при котором сервер (но не клиент) проходит [аутентификацию](https://ru.wikipedia.org/wiki/%D0%90%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F_%D0%B2_%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82%D0%B5) по его сертификату.

1. Фаза переговоров:
    - Клиент посылает сообщение **ClientHello**, указывая последнюю версию поддерживаемого TLS-протокола, случайное число и список поддерживаемых наборов шифров, подходящих для работы с TLS;
    - Сервер отвечает сообщением **ServerHello**, содержащим: выбранную сервером версию протокола, случайное число, сгенерированное сервером, выбранный шифронабор из списка, предоставленного клиентом;
    - Сервер посылает сообщение **Certificate**, которое содержит цифровой сертификат сервера.
    - Если переданных сервером данных недостаточно для выработки общего симметричного секретного ключа в рамках выбранного шифронабора, сервер передаёт сообщение **ServerKeyExchange**, в котором передаются необходимые данные.
    - Сервер отсылает сообщение **ServerHelloDone**, идентифицирующее окончание первого раунда установления соединения;
    - Клиент отвечает сообщением **ClientKeyExchange**, которое содержит клиентскую часть протокола Диффи-Хеллмана или зашифрованный открытым ключом из сертификата сервера секрет (**PreMasterSecret**);
    - Клиент и сервер, используя ключ **PreMasterSecret** и случайно сгенерированные числа, вычисляют общий секрет. Вся остальная информация о сеансовом ключе будет получена из общего секрета;
2. Клиент посылает сообщение **ChangeCipherSpec**, которое указывает на то, что вся последующая информация будет зашифрована установленным в процессе подтверждения связи алгоритмом, используя общий секретный ключ:
    - Клиент посылает сообщение **Finished**, которое содержит хеш и MAC, сгенерированные на основе предыдущих сообщений процедуры подтверждения связи;
    - Сервер пытается расшифровать Finished-сообщение клиента и проверить хеш и МАС. Если процесс расшифровки или проверки не удаётся, подтверждение связи считается неудавшимся, и соединение должно быть оборвано;
3. Сервер посылает **ChangeCipherSpec** и зашифрованное сообщение Finished, и в свою очередь клиент тоже выполняет расшифровку и проверку.

Атаки CRIME и BREACH — это атаки на основе сниффинга трафика (man-in-the-middle), которые используют сжатие данных в протоколе TLS/SSL для извлечения конфиденциальной информации, например, cookie-файлов.

### Какие алгоритмы шифрования использует TLS

В последней версии протокола доступны следующие алгоритмы:

- для обмена ключами и проверки их подлинности применяются комбинации алгоритмов: [RSA](https://ru.wikipedia.org/wiki/RSA) (асимметричный шифр), [Diffie-Hellman](https://ru.wikipedia.org/wiki/Diffie-Hellman) (безопасный обмен ключами), [DSA](https://ru.wikipedia.org/wiki/DSA) (алгоритм цифровой подписи), [ECDSA](https://ru.wikipedia.org/wiki/ECDSA);
- для симметричного шифрования: [RC4](https://ru.wikipedia.org/wiki/RC4), [IDEA](https://ru.wikipedia.org/wiki/IDEA), [Triple DES](https://ru.wikipedia.org/wiki/Triple_DES), [SEED](https://ru.wikipedia.org/wiki/SEED), [Camellia](https://ru.wikipedia.org/wiki/Camellia_(%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC)) или [AES](https://ru.wikipedia.org/wiki/Advanced_Encryption_Standard);
- для [хеш-функций](https://ru.wikipedia.org/wiki/%D0%A5%D0%B5%D1%88%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5): [MD5](https://ru.wikipedia.org/wiki/MD5), [SHA](https://ru.wikipedia.org/wiki/SHA-1), [SHA-256/384](https://ru.wikipedia.org/wiki/SHA-2).

Аналоги TSL - IPsec, SSH.

## HTTP Methods

![image.png](image%20379.png)

### Safe HTTP Methods

Метод HTTP является безопасным лишь тогда, когда он не изменяет состояния сервера. Другими словами, метод безопасен, когда он запрашивает лишь операцию чтения.

Безопасные методы - GET, HEAD, OPTIONS. Все безопасные методы идемпотентны, но не все идемпотентные методы безопасны. Пример небезопасных методов - PUT и DELETE.

Важное уточнение: приложение на сервере обязано корректно реализовать семантику безопасности, поскольку сам веб-сервер, будь то Apache, Nginx или IIS, не может обеспечить её самостоятельно. В частности, приложение не должно позволять GET-запросам изменять своё состояние.

### Idempotent HTTP Methods

Метод HTTP является идемпотентным, если предполагаемый эффект на сервере от выполнения одного запроса такой же, как эффект от выполнения нескольких идентичных запросов.

Идемпотентны - GET, HEAD, OPTIONS, PUT, DELETE.

Спецификация HTTP определяет идемпотентность только с точки зрения предполагаемого воздействия клиента на сервер. Например, запрос POST предназначен для отправки данных на сервер, тогда как запрос DELETE предназначен для удаления ресурса на сервере. На практике сервер должен убедиться, что предоставляемые им маршруты соответствуют этой семантике.

## HTTP Status Codes

### What is HTTP?

HTTP (Hypertext Transfer Protocol) — это протокол прикладного уровня, предназначенный для передачи информации между сетевыми устройствами и работающий поверх других уровней стека сетевых протоколов.

HTTP запрос состоит из:

- Тип версии HTTP
- URL (Uniform Resource Locator)
- HTTP метод
- HTTP заголовки запроса
- Тело HTTP (опциально)

HTTP-заголовки содержат текстовую информацию, хранящуюся в парах «ключ-значение», и включаются в каждый HTTP-запрос и ответ. Эти заголовки передают основную информацию, например, какой браузер использует клиент и какие данные запрашиваются.

![image.png](image%20380.png)

Тело запроса — это часть, содержащая «тело» передаваемой информации. Тело HTTP-запроса содержит всю информацию, передаваемую веб-серверу, например, имя пользователя и пароль, а также любые другие данные, введённые в форму.

HTTP-ответ — это то, что веб-клиенты получают от интернет-сервера в ответ на HTTP-запрос. Эти ответы содержат ценную информацию, основанную на том, что было запрошено в HTTP-запросе.

HTTP-ответ состоит из:

- HTTP код статуса
- HTTP заголовки ответа
- Тело HTTP (опционально)

Подобно HTTP-запросу, HTTP-ответ содержит заголовки, которые содержат важную информацию, такую как язык и формат данных, отправляемых в теле ответа.

![image.png](image%20381.png)

Успешные HTTP-ответы на GET-запросы обычно содержат тело, содержащее запрошенную информацию. В большинстве веб-запросов это HTML-данные, которые браузер преобразует в веб-страницу.

В контексте DoS- или DDoS-атак HTTP-запросы в больших количествах могут использоваться для атаки на целевое устройство.

### HTTP коды статуса

- 1.xx - Информационные

100 - Continue

101 - Switching Protocols

102 - Processing

103 - Early Hints (Предварительный ответ)

- 2.xx - Успеха

200 - OK

201 - Created

202 - Accepted

203 -Non-Authoritative Information

- 3.xx - Перенаправления (на другой запрос)

300 - Multiple Choices

301- Moved Permantetly

302 - Found

- 4.xx - Ошибки клиента

400 - Bad request

401 - Unauthorized

403 - Forbidden (Запрещено)

404 - Not Found

414 - URL Too Long

451 - Unavailable For Legal Reasons (Недоступно по юридическим причинам) 

- 5.xx - Ошибки сервера

500 - Internal Server Error

502 - Bad Gameway

505 - HTTP Version Not Supported

520 - Unknown Error

### What is HTTPS?

Протокол HTTPS (Hypertext Transfer Protocol Secure) — это защищённая версия HTTP, основного протокола, используемого для передачи данных между веб-браузером и веб-сайтом. HTTPS использует шифрование (SSL, TSL) для повышения безопасности передачи данных. Это особенно важно, когда пользователи передают конфиденциальные данные, например, при входе в банковский счёт, службу электронной почты или страховую компанию.
Любой веб-сайт, особенно требующий учётных данных, должен использовать HTTPS. В современных веб-браузерах, таких как Chrome, веб-сайты, не использующие HTTPS, помечаются иначе, чем те, которые используют. Значок замка в адресной строке означает, что веб-страница защищена.

Тип безопасности системы использует два разных ключа для шифрования данных между двумя сторонами:

- Закрытый ключ — этот ключ контролируется владельцем веб-сайта и хранится в тайне. Этот ключ хранится на веб-сервере и используется для расшифровки информации, зашифрованной открытым ключом.
- Открытый ключ — этот ключ доступен всем, кто хочет взаимодействовать с сервером безопасным способом. Информация, зашифрованная открытым ключом, может быть расшифрована только закрытым ключом.

HTTPS предотвращает передачу информации веб-сайтами таким образом, что её легко может просмотреть любой, кто следит за сетью. При передаче по обычному протоколу HTTP информация разбивается на пакеты, которые легко перехватываются с помощью свободного программного обеспечения. Это делает обмен данными по незащищённой среде, такой как общедоступный Wi-Fi, крайне уязвимым для перехвата. Фактически, все сообщения по протоколу HTTP передаются в виде открытого текста, что делает их легкодоступными для любого, у кого есть необходимые инструменты, и уязвимыми для атак по пути передачи данных.

HTTPS использует порт 443. Это отличает HTTPS от HTTP, который использует порт 80. 

*Порт — это виртуальная программная точка, где начинаются и заканчиваются сетевые соединения. Все компьютеры, подключенные к сети, предоставляют ряд портов для приема трафика. Каждый порт связан с определенным процессом или службой, и разные протоколы используют разные порты.*

HTTPS не позволяет злоумышленникам пассивно прослушивать коммуникации между вашими веб-сайтами и вашими пользователями.

Одно из распространённых заблуждений относительно HTTPS заключается в том, что HTTPS нужен только тем сайтам, которые обрабатывают конфиденциальные данные. На самом деле, каждый незащищённый HTTP-запрос потенциально может раскрыть информацию о поведении и личности ваших пользователей.

Однократное посещение одного из ваших незащищённых веб-сайтов может показаться безобидным, но некоторые злоумышленники анализируют совокупную активность ваших пользователей в браузере, чтобы сделать выводы об их поведении и намерениях, а также деанонимизировать их личности.