# 11. Other

Категория: Docker & Kubernetes
Статус: Готово

### Gunicorn & Uvicorn

Веб-сервер, в рамках применения в Python, это программа, которая запускает Python-приложение и обеспечивает его взаимодействие с внешним миром по протоколу HTTP (или другим, если необходимо, например, WebSocket).

Веб-сервер принимает внешние запросы, передаёт их в приложение через интерфейс (WSGI, ASGI или RSGI), а затем возвращает ответ. Проще говоря, веб-сервер — это связующее звено между кодом и пользователем.

Для "общения" между веб-сервером и приложением существует три интерфейса взаимодействия:

- **WSGI** (Web Server Gateway Interface).
- **ASGI** (Asynchronous Server Gateway Interface).
- **RSGI** (Rust Server Gateway Interface).

### **WSGI (Web Server Gateway Interface)**

Стандарт интерфейса между Python-приложением и веб-сервером, появившийся ещё в Python 2.2 (PEP 333, потом обновлён до PEP 3333).

- **Синхронный** интерфейс взаимодействия — обрабатывает запросы один за другим.
- Применяется преимущественно в "классических" фреймворках, вроде Django или Flask.
- Не поддерживает WebSocket, SSE (Server-Sent Events) и некоторые другие возможности.

Достаточно простой интерфейс, подходящий для небольших и низконагруженных приложений.

### **ASGI (Asynchronous Server Gateway Interface)**

Современный стандарт интерфейса для Python-приложений. Придуман как "духовный наследник" WSGI.

- **Синхронный и асинхронный** интерфейс взаимодействия — может обрабатывать множество запросов одновременно.
- Применяется в "молодых" фреймворках, вроде FastAPI, а также может применяться в Django (через Channels) или Flask.
- Поддерживает WebSocket, SSE, HTTP/2 и так далее.

Актуальный интерфейс взаимодействия для больших и высоконагруженных приложений.

### **Gunicorn (WSGI)**

Лёгкий WSGI-сервер для Python (Green Unicorn). Широко используется с Django/Flask. Работает по схеме prefork (несколько процессов-воркеров).

- **Конфигурация:** простая. Например, `gunicorn --workers 4 myproject.wsgi:application`. Хорошо масштабируется на нескольких ядрах. **Формула расчета воркеров**: рекомендуется число воркеров ≈ (2 × количество CPU ядер) + 1.
- **Особенности:** реализует только WSGI, **не поддерживает ASGI/async** "из коробки". Для работы с асинхронными задачами можно применять сторонние классы воркеров (gevent/eventlet) или использовать `gunicorn` + `uvicorn`воркеры. Не имеет встроенной поддержки WebSocket (только HTTP).
- **Производительность:** хорошие показатели для синхронных нагрузок. **~3 000-10 000 запросов/сек** — в зависимости от числа воркеров, окружения, нагрузки. При этом память на воркер ~30 MB.

### **Uvicorn (ASGI)**

Лёгкий ASGI-сервер для Python. Построен на основе uvloop и httptools (Cython). Предназначен для асинхронных приложений (Starlette, FastAPI, Django Channels).

- **Конфигурация:** очень простая. Запускается одной командой: `uvicorn myapp.asgi:application --workers 4`. Не имеет сложных конфигов, можно задавать параметры в CLI или скрипте Python.
- **Особенности:** поддерживает HTTP/1.1, HTTP/2, WebSocket. Имеет низкий оверхед и малый размер кода, использует готовые асинхронные event loop (uvloop).
- **Производительность:** высокая: **~35 000-40 000 запросов/сек**. Низкая задержка. Память на воркер примерно 20 MB.

![image.png](image%20779.png)

![image.png](image%20780.png)

![image.png](image%20781.png)

### Nginx

Nginx (произносится «энджи́нкс») — это высокопроизводительное программное обеспечение с открытым исходным кодом, которое работает как веб-сервер (для доставки файлов сайта), обратный прокси-сервер (для распределения нагрузки и кэширования), балансировщик нагрузки (распределяет запросы между несколькими серверами), а также как почтовый прокси или сервер для HTTP кэширования. Его главная роль — быстро и эффективно обрабатывать HTTP-запросы, особенно на высоконагруженных сайтах, снимая часть нагрузки с application-серверов и повышая отказоустойчивость.

Основные роли и функции Nginx

- Веб-сервер: Отдает статические файлы (HTML, CSS, JS, изображения) напрямую пользователям, обрабатывая HTTP-запросы и формируя HTTP-ответы.
- Обратный прокси (Reverse Proxy): Принимает запросы клиентов и перенаправляет их на другие серверы (например, Apache или PHP-FPM), скрывая их от пользователя. Это повышает безопасность и производительность.
- Балансировщик нагрузки (Load Balancer): Распределяет входящий трафик между несколькими внутренними серверами, чтобы ни один из них не был перегружен, что улучшает доступность и надежность сервиса.
- Кэширование (Caching): Сохраняет часто запрашиваемые данные, чтобы отдавать их быстрее, не обращаясь к серверу каждый раз.
- HTTP-кэш: Может выступать как кэш для статического и даже динамического контента, ускоряя загрузку страниц.
- Почтовый прокси: Может перенаправлять запросы POP3, IMAP и SMTP.
- Брандмауэр для веб-приложений (WAF): Фильтрует вредоносные запросы, защищая приложение от атак (например, DDoS).

Зачем он нужен?

Nginx создан для решения проблем производительности, возникающих при росте трафика. Он позволяет:

- Снизить нагрузку на основные серверы, обрабатывая статику и распределяя динамические запросы.
- Повысить отказоустойчивость благодаря балансировке нагрузки.
- Ускорить сайты за счет эффективного кэширования и доставки контента.
- Упростить управление трафиком и обеспечить безопасность.